
# **产品需求文档 (PRD) - ImageFlow**

## **1. 产品概述**

### **1.1 产品愿景**
ImageFlow 致力于成为用户处理在线图片的首选工具。通过极致简约的设计、强大的客户端处理能力和对下一代图片格式的全面支持，我们为用户提供无缝、高效、安全的图片压缩与格式转换体验。

### **1.2 产品目标**
*   **核心功能:** 提供稳定、高效的图片压缩与格式转换，特别是对WebP和AVIF格式的卓越支持。
*   **用户体验:** 打造零学习成本的直观界面，实现交互流畅、视觉愉悦，并通过个性化主题（亮色/暗色/护眼）提升用户满意度。
*   **性能与隐私:** 核心处理100%在浏览器端完成，保障用户数据隐私。利用Web Workers确保复杂计算不阻塞UI，提供流畅体验。
*   **商业化:** 通过在非核心区域合理布局Google AdSense广告，实现产品的可持续发展。

## **2. 用户画像与场景**

| 用户画像       | 角色描述                                                 | 核心场景 (Scenario)                                                                                                                              |
| :------------- | :------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------- |
| **前端开发者**   | 关注网站性能和最新技术，需要将图片优化到极致。           | 在部署新版本网站前，将所有静态图片资源（JPG, PNG）批量拖拽到ImageFlow，一键转换为AVIF格式并进行高质量压缩，然后下载ZIP包替换原有资源。 |
| **内容创作者** | 每日需处理大量图片用于博客和社交媒体，对效率要求高。 | 为一篇博客文章准备配图，将多张高清照片上传，统一调整压缩质量，并将部分HEIC格式的照片转换为通用的JPG格式，整个过程在同一页面完成。         |
| **普通用户**     | 偶尔需要处理图片，例如转换格式或减小文件大小以便发送邮件。 | 想要将手机拍摄的几张照片通过邮件发送，但附件大小超限。打开ImageFlow，将图片拖入，使用默认设置压缩后，打包下载并成功发送邮件。             |

## **3. 功能性需求**

### **Epic 1: 核心图片处理流程**

**用户故事 1.1: 图片上传与管理**
> **作为一名用户，我希望能方便地上传单张或多张图片，并在一个清晰的列表中进行管理。**

*   **验收标准:**
    1.  页面中央提供一个响应式的拖拽区域，支持文件和文件夹拖拽上传。
    2.  提供一个“选择文件”按钮，点击后可打开本地文件浏览器。
    3.  上传的图片以卡片列表形式展示，每张卡片包含缩略图、文件名、原始文件大小和移除按钮。

**用户故事 1.2: 实时可控的图片压缩**
> **作为一名设计师，我希望能实时预览压缩效果，并通过简单的滑块精确控制图片质量，以在文件大小和视觉效果间找到完美平衡。**

*   **验收标准:**
    1.  配置面板提供一个范围为0-100的“质量”滑块，默认值为75。
    2.  提供一个实时对比预览窗口，用户可左右拖动分割线，直观对比压缩前后的图片细节。
    3.  调整滑块时，预览图、预计压缩后的文件大小和压缩率百分比必须在500ms内实时更新。
    4.  所有压缩计算任务必须在Web Worker中执行，确保UI界面在处理过程中保持流畅不卡顿。

**用户故事 1.3: 高效的批量处理与下载**
> **作为一名内容创作者，我希望能一次性处理完所有图片，即使数量较多也能稳定运行，并一键打包下载，以节省我的时间。**

*   **验收标准:**
    1.  用户可以对队列中的所有图片应用统一的压缩和转换设置。
    2.  提供“全部下载”按钮，点击后，所有处理完成的图片将被打包成一个`.zip`文件并自动开始下载。
    3.  系统需在前端对上传文件进行预检，并执行以下限制：单次上传文件数量不得超过 **50** 个，总体积不得超过 **200MB**。
    4.  当用户上传的文件超出任一限制时，系统不得拒绝，而是自动将任务队列拆分为多个合规批次，并向用户提示“文件过多，已为您自动分批处理”，同时在后台按顺序执行。

### **Epic 2: 高级格式支持与体验**

**用户故事 2.1: 面向未来的格式转换 (含AVIF)**
> **作为一名前端开发者，我希望能将图片转换为压缩率最高的AVIF格式，并且无论是大图还是小图，都能获得高质量且稳定的转换结果。**

*   **验收标准:**
    1.  支持将图片转换为JPG, PNG, WebP格式。所有转换在客户端完成。
    2.  当用户选择输出格式为“AVIF”时，系统默认采用“高质量转换”模式，通过Supabase边缘函数进行服务端处理。前端需清晰展示“云端引擎处理中”的状态。
    3.  当服务端转换失败（如超时）时，系统需自动降级至客户端WASM库进行处理，并提示用户：“高质量转换超时，已切换为快速模式。”
    4.  服务端转换功能必须通过Vercel环境变量进行控制，以便在需要时可被管理员一键禁用。

**用户故事 2.2: 个性化主题切换**
> **作为一名长时间在电脑前工作的用户，我希望能切换到深色或护眼模式，以减轻眼睛的疲劳。**

*   **验收标准:**
    1.  界面右上角提供清晰的主题切换图标，支持亮色（默认）、暗色、护眼（暖色调低对比度）三种模式。
    2.  切换主题时，页面颜色有平滑的CSS过渡效果，不产生闪烁。
    3.  用户的选择通过`localStorage`进行持久化，下次访问时自动应用。首次访问则根据用户系统设置（`prefers-color-scheme`）智能匹配。

### **Epic 3: 全链路容错与健壮性**

**用户故事 3.1: 智能的错误处理**
> **作为一名普通用户，当操作出错时，我希望能得到清晰、易懂的提示，并知道下一步该怎么做。**

*   **验收标准:**
    1.  **文件预检:** 系统通过读取文件头部的Magic Number校验文件类型。若上传非图片文件，应拦截并提示“文件[文件名]格式异常，请上传真实的图片文件。”
    2.  **网络容错:** 在使用服务端转换时，若网络中断，任务应暂停并提供手动“重试”按钮。
    3.  **编码失败回退:** 若AVIF编码失败，系统应自动回退到WebP格式，并提示用户：“图片过大无法生成AVIF，已为您自动优化为WebP格式。”
    4.  **状态可视化:** 处理队列中的每个文件卡片都应有明确的状态指示器（如：处理中、成功、失败）。鼠标悬停在失败状态上时，应显示简明的错误原因。
    5.  **恢复机制:** 对于因临时问题导致失败的任务，系统应缓存其处理参数，用户点击“重试”时无需重新上传和设置。

## **4. 非功能性需求**

| 类别           | 需求描述                                                                                                                                                                             |
| :------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **性能**       | - **首次内容绘制 (FCP):** 必须在 1.5 秒内完成。 <br>- **UI响应性:** 所有交互必须无卡顿，核心计算在Web Worker中进行。<br>- **服务端冷启动:** Edge Function的冷启动时间需优化，目标在1秒内响应。 |
| **UI/UX**      | - **设计语言:** 现代、简洁、直观，有充足的留白和清晰的视觉层次。<br>- **交互反馈:** 所有操作（上传、处理、下载）都必须有即时的视觉反馈（进度条、成功提示等）。<br>- **响应式设计:** 完美适配桌面、平板和移动端。 |
| **隐私与安全** | - **数据处理:** 在网站页脚明确声明“您的图片仅在浏览器中处理，绝不上传至服务器”，以建立用户信任。<br>- **环境变量:** Google AdSense的发布商ID等敏感信息必须通过Vercel的环境变量注入，严禁硬编码。 |
| **可访问性 (A11y)** | - **色彩对比度:** 所有主题模式下的文本和背景色对比度需满足WCAG 2.1 AA标准。<br>- **键盘导航:** 所有交互元素都必须支持键盘操作。 |
| **系统稳定性**   | - **资源监控:** 需建立机制监控Supabase存储桶空间。当使用率超过90%时，系统应自动发送告警给管理员，并可临时禁用上传功能，向用户显示“系统维护中，请稍后再试”。 |

## **5. 功能范围**

### **5.1 范围内 (In Scope)**
*   完整的图片压缩与格式转换功能 (JPG, PNG, WebP, AVIF)。
*   包含上限控制和自动分批的批量处理机制。
*   基于服务端优先、客户端兜底的AVIF转换策略。
*   亮色、暗色、护眼三种主题模式。
*   覆盖全链路的精细化错误处理机制。
*   Google AdSense广告集成。

### **5.2 范围外 (Out of Scope)**
*   用户账户系统（注册、登录、历史记录保存）。
*   高级图片编辑功能（如裁剪、旋转、滤镜、水印等）。
*   生成图片分享链接。